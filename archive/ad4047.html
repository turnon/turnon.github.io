<!DOCTYPE html> <html> <head> <meta content="IE=edge" http-equiv=X-UA-Compatible> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name=viewport> <title>Zp Yuan eval vs instance_eval vs instance_exec vs class_eval vs module_eval</title> <link href="/bundle-d18183fc.css" rel=stylesheet /> </head> <body> <nav> <ul> <li class="toc-button invisible"><a>目录</a></li> <li><a href="/index.html">笔记</a></li> <li><a href="http://whispering-fortress-75887.herokuapp.com/">统计</a></li> <li><a href="/about.html">关于</a></li> </ul> </nav> <aside> <div class=tags> <ul> <li> <a class=post-tag href="/index.html?tag=ruby"> <span>ruby</span> <span>42</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=metaprogramming"> <span>metaprogramming</span> <span>11</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=rails"> <span>rails</span> <span>10</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=versus"> <span>versus</span> <span>9</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=javascript"> <span>javascript</span> <span>8</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=sinatra"> <span>sinatra</span> <span>7</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=pattern"> <span>pattern</span> <span>5</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=rack"> <span>rack</span> <span>4</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=minitest"> <span>minitest</span> <span>3</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=underscore"> <span>underscore</span> <span>3</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=debug"> <span>debug</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=concurrency"> <span>concurrency</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=jekyll"> <span>jekyll</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=test"> <span>test</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=middleman"> <span>middleman</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=functional"> <span>functional</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=tilt"> <span>tilt</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=java"> <span>java</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=rubinius"> <span>rubinius</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=jquery"> <span>jquery</span> <span>1</span> </a> </li> </ul> </div> </aside> <article> <h1 class=post-title>eval vs instance_eval vs instance_exec vs class_eval vs module_eval</h1> <span class=post-date>2015-05-25</span> <a class=post-tag href="/index.html?tag=metaprogramming">metaprogramming</a> <a class=post-tag href="/index.html?tag=ruby">ruby</a> <a class=post-tag href="/index.html?tag=versus">versus</a> <div> <span><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"> <div>它们各自来源于：Kernel#eval，BasicObject#instance_eval，BasicObject#instance_exec，Module#class_eval（module_eval是其别名）</div> <div><br></div> <div>即是，任何东西都可instance_eval/instance_exec ，而class_eval只能在Module/Class的new方法所产生的东西上调用，eval只能在Object以下的东西上调用</div> <div><br></div> <div>eval的参数如下：eval( string ‹ , binding ‹ , file ‹ , line ››› )，可传一个binding给它，以改变执行环境，而其它_eval只能作用于方法的接收者</div> <div><br></div> <div>当用于定义方法时，if you want to point out that "I am dealing with a class" or "I want to add methods on all instances of that class", use class_eval . otherwise, use instance_eval.</div> <div><br></div> <div><a href="/images/ad4047/576890.gif" target=_blank><img src="/images/ad4047/576890.gif" type="image/gif" style="cursor: default; height: auto;"></a></div> <div>instance_eval与instance_exec区别在于，_eval不接收实参，而_exec可以（甚至可以传别的对象）</div> <div><br></div> <div>这使得instance_exec就像是在某对象上调用一个可接受参数的方法一样</div> <div><br></div> <div>instance_eval其实会yield自身给block，因proc对参数不敏感而lambda却敏感，所以lambda需写明形参</div> <div><br></div> <div>因此，以下都是能正常运行的</div> <div><br></div> <div>（若想确定instance_exec 时该传多少/什么参数给block，可检查arity）</div> <div><br></div> <div class=ever-code><pre><code>irb:01:0&gt; require 'ostruct'
irb:02:0&gt; a, b, c = %w{a b c}.map do |name|
irb:03:1*       OpenStruct.new(name: name)
irb:04:1&gt;   end
irb:05:0&gt; a.instance_eval {puts name; puts c.name}
a
c
irb:06:0&gt; a.instance_eval &amp;Proc.new{puts name; puts c.name}
a
c
irb:07:0&gt; a.instance_eval &amp;-&gt; o {puts name; puts o.name; puts c.name}
a
a
c
irb:08:0&gt; a.instance_exec {puts name; puts c.name}
a
c
irb:09:0&gt; a.instance_exec &amp;Proc.new{puts name; puts c.name}
a
c
irb:10:0&gt; a.instance_exec(b){|c| puts name; puts c.name}
a
b
irb:11:0&gt; a.instance_exec b, &amp;-&gt; o {puts name; puts c.name }
a
c
irb:12:0&gt;</code></pre></div> <div><br></div> </div></span> </div> </article> <script src="/javascripts/bundle-d6f5bf21.js"></script> </body> </html>
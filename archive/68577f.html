<!doctype html> <html> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content="chrome=1"> <title>Zp Yuan Ruby的ARGF</title> <link href="/bundle-1857e13f.css" rel=stylesheet /> <meta name=viewport content="width=device-width"> <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--> </head> <body> <div class=wrapper> <header> <ul> <li class=current><a href="/index.html"><strong>笔记</strong></a></li> <li><a href="/statistics.html"><strong>统计</strong></a></li> <li><a href="/about.html"><strong>关于</strong></a></li> </ul> <div class=tags> <ol> <li> <a class=post-tag href="/index.html?tag=ruby"> <span>ruby</span> <span>57</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=rails"> <span>rails</span> <span>27</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=metaprogramming"> <span>metaprogramming</span> <span>11</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=versus"> <span>versus</span> <span>11</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=sinatra"> <span>sinatra</span> <span>7</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=test"> <span>test</span> <span>5</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=rack"> <span>rack</span> <span>4</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=minitest"> <span>minitest</span> <span>3</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=debug"> <span>debug</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=concurrency"> <span>concurrency</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=pattern"> <span>pattern</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=javascript"> <span>javascript</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=jekyll"> <span>jekyll</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=middleman"> <span>middleman</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=functional"> <span>functional</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=tilt"> <span>tilt</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=jquery"> <span>jquery</span> <span>1</span> </a> </li> </ol> </div> </header> <section> <article> <h1 class=post-title>Ruby的ARGF</h1> <span class=post-date>2016-09-07</span> <a class=post-tag href="/index.html?tag=ruby">ruby</a> <div> <span><div>unix命令如cat，grep，sed，既可以读取命令行参数中指定的文件的内容，也可以读取stdin的输入（当命令行参数中无文件时 ）。若想在ruby中实现类似功能，可这样：</div> <div><br></div> <div class=ever-code><pre><code># cat.rb

if ARGV.length &gt; 0
  ARGV.each do |filename|
    puts File.read(filename)
  end
else
  puts STDIN.read
end</code></pre></div> <div><br></div> <div><br></div> <div>先读取ARGV，，如没有文件，则STDIN。使用方法如下：</div> <div><br></div> <div class=ever-code><pre><code>$ ruby cat.rb file1 file2
Contents of file1
Contents of file2
$ echo "Contents of standard input" | ruby cat.rb
Contents of standard input</code></pre></div> <div><br></div> <div><br></div> <div>虽然能跑，但此实现方法太过纠结于输入从何处而来，并且puts语句在两个分支中重复了。为了解决这个问题，可用ARGF：</div> <div><br></div> <div class=ever-code><pre><code># argf.rb

puts ARGF.read</code></pre></div> <div><br></div> <div><br></div> <div>这样，你就无需关心输入流来自哪里了。</div> <div><br></div> <div>而对于ARGF，api文档是这么说的：</div> <div><br></div> <div>ARGF is a stream designed for use in scripts that process files given as command-line arguments or passed in via STDIN.</div> <div><br></div> <div>即是，ARGF.read的处理流程如刚才的if ARGV else STDIN。</div> <div><br></div> <div>因此，无论你用if..else..，还是ARGF，--color、--line-buffered之类的标志都必须先从ARGV中拿掉，否则将这些标志当成文件来读取时，就会报错No such file or directory。</div> <div><br></div> <div>而自己在程序中加到ARGV的文件名，也会被ARGF读到。</div> <div><br></div> <div>同if..else..一样，读的过程中，会先将文件名从ARGV里shift出</div> <div><br></div> <div>使用cat时，如果既想读文件，又想读stdin，可这样：</div> <div><br></div> <div class=ever-code><pre><code>$ echo "Contents of standard input" | cat file1 - file2
Contents of file1
Contents of standard input
Contents of file2</code></pre></div> <div><br></div> <div><br></div> <div>对此，ARGF也是很方便地支持了：</div> <div><br></div> <div class=ever-code><pre><code>$ echo "Contents of standard input" | ruby argf.rb file1 - file2
Contents of file1
Contents of standard input
Contents of file2</code></pre></div> <div><br></div> <div><br></div> <div>如果想得知正在读取的是那个文件，可用#file，它返回File对象（如果是stdin，则是IO对象）：</div> <div><br></div> <div class=ever-code><pre><code># file.rb

p ARGF.file
ARGF.read(ARGF.file.size + 1) # The extra byte read is EOF
p ARGF.file
ARGF.read(ARGF.file.size + 1)
p ARGF.file</code></pre></div> <div><br></div> <div><br></div> <div>测试：</div> <div><br></div> <div class=ever-code><pre><code>$ echo "Contents of standard input" | ruby file.rb file1 file2 -
#&lt;File:file1&gt;
#&lt;File:file2&gt;
#&lt;IO:&lt;STDIN&gt;&gt;</code></pre></div> <div><br></div> <div><br></div> <div>若只需要文件名，用#filename。</div> <div><br></div> <div>如果你只想读取某些文件……例如只想要YAML，那么可如下例，使用#close来跳到下个文件：</div> <div><br></div> <div class=ever-code><pre><code># front_matter.rb

ARGF.each_line do |line|
  if ARGF.lineno &gt; 1 &amp;&amp; line == "---\n"
    ARGF.close
  end
  puts line
end</code></pre></div> <div><br></div> <div><br></div> <div>测试：</div> <div><br></div> <div class=ever-code><pre><code>$ ruby front_matter.rb post1.md post2.md
---
title: My First Blog Post
---
---
title: My Second Blog Post
---</code></pre></div> <div><br></div></span> </div> </article> </section> <footer> </footer> </div> <script src="/javascripts/bundle-853f63ec.js"></script> </body> </html>
<!doctype html> <html> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content="chrome=1"> <title>Zp Yuan eval、instance_eval、instance_exec、class_eval、module_eval的区别</title> <link href="/bundle-1857e13f.css" rel=stylesheet /> <meta name=viewport content="width=device-width"> <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--> </head> <body> <div class=wrapper> <header> <ul> <li class=current><a href="/index.html"><strong>笔记</strong></a></li> <li><a href="/statistics.html"><strong>统计</strong></a></li> <li><a href="/about.html"><strong>关于</strong></a></li> </ul> <div class=tags> <ol> <li> <a class=post-tag href="/index.html?tag=ruby"> <span>ruby</span> <span>61</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=rails"> <span>rails</span> <span>31</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=metaprogramming"> <span>metaprogramming</span> <span>12</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=versus"> <span>versus</span> <span>11</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=sinatra"> <span>sinatra</span> <span>7</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=test"> <span>test</span> <span>5</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=rack"> <span>rack</span> <span>4</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=minitest"> <span>minitest</span> <span>3</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=debug"> <span>debug</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=concurrency"> <span>concurrency</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=pattern"> <span>pattern</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=javascript"> <span>javascript</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=jekyll"> <span>jekyll</span> <span>2</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=middleman"> <span>middleman</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=functional"> <span>functional</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=tilt"> <span>tilt</span> <span>1</span> </a> </li> <li> <a class=post-tag href="/index.html?tag=jquery"> <span>jquery</span> <span>1</span> </a> </li> </ol> </div> </header> <section> <article> <h1 class=post-title>eval、instance_eval、instance_exec、class_eval、module_eval的区别</h1> <span class=post-date>2015-05-25</span> <a class=post-tag href="/index.html?tag=metaprogramming">metaprogramming</a> <a class=post-tag href="/index.html?tag=ruby">ruby</a> <a class=post-tag href="/index.html?tag=versus">versus</a> <div> <span><div>它们各自来源于：Kernel#eval，BasicObject#instance_eval，BasicObject#instance_exec，Module#class_eval（module_eval是其别名）</div> <div><br></div> <div>即是，任何东西都可instance_eval/instance_exec ，而class_eval只能在Module/Class的new方法所产生的东西上调用，eval只能在Object以下的东西上调用</div> <div><br></div> <div>eval的参数如下：eval( string ‹ , binding ‹ , file ‹ , line ››› )，可传一个binding给它，以改变执行环境，而其它_eval只能作用于方法的接收者</div> <div><br></div> <div>当用于定义方法时，if you want to point out that "I am dealing with a class" or "I want to add methods on all instances of that class", use class_eval . otherwise, use instance_eval.</div> <div><br></div> <div><a href="/images/e705b4/576890.gif" target=_blank><img src="/images/e705b4/576890.gif" type="image/gif" style="cursor: default; height: auto;"></a></div> <div>instance_eval与instance_exec区别在于，_eval不接收实参，而_exec可以（甚至可以传别的对象）</div> <div><br></div> <div>这使得instance_exec就像是在某对象上调用一个可接受参数的方法一样</div> <div><br></div> <div>instance_eval其实会yield自身给block，因proc对参数不敏感而lambda却敏感，所以lambda需写明形参</div> <div><br></div> <div>因此，以下都是能正常运行的</div> <div><br></div> <div>（若想确定instance_exec 时该传多少/什么参数给block，可检查arity）</div> <div><br></div> <div class=ever-code><pre><code>irb:01:0&gt; require 'ostruct'
irb:02:0&gt; a, b, c = %w{a b c}.map do |name|
irb:03:1*       OpenStruct.new(name: name)
irb:04:1&gt;   end
irb:05:0&gt; a.instance_eval {puts name; puts c.name}
a
c
irb:06:0&gt; a.instance_eval &amp;Proc.new{puts name; puts c.name}
a
c
irb:07:0&gt; a.instance_eval &amp;-&gt; o {puts name; puts o.name; puts c.name}
a
a
c
irb:08:0&gt; a.instance_exec {puts name; puts c.name}
a
c
irb:09:0&gt; a.instance_exec &amp;Proc.new{puts name; puts c.name}
a
c
irb:10:0&gt; a.instance_exec(b){|c| puts name; puts c.name}
a
b
irb:11:0&gt; a.instance_exec b, &amp;-&gt; o {puts name; puts c.name }
a
c
irb:12:0&gt;</code></pre></div> <div><br></div></span> </div> </article> </section> <footer> </footer> </div> <script src="/javascripts/bundle-853f63ec.js"></script> </body> </html>